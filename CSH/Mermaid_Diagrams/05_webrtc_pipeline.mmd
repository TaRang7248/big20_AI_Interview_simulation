flowchart LR
    subgraph BROWSER["Browser"]
        CAM["Camera"]
        MIC["Microphone"]
    end

    subgraph SIGNALING["Signaling"]
        SDP["SDP Offer/Answer\n/offer"]
    end

    subgraph SERVER["aiortc Server"]
        VIDEO_TRACK["Video Track\nReceive"]
        AUDIO_TRACK["Audio Track\nReceive"]
    end

    subgraph PROCESSING["Realtime Processing"]
        DF["DeepFace\nFacial Emotion 7"]
        GT["Eye Tracking\nEye Contact %"]
        STT_P["STT\nDeepgram/Whisper"]
        REC["Recording\nGStreamer"]
    end

    subgraph OUTPUT["Analysis Output"]
        EMOTION_OUT["Emotion TimeSeries\nRedis TimeSeries"]
        TEXT_OUT["Text Transcription\nWebSocket Push"]
        FILE_OUT["Recording File\nuploads/"]
    end

    CAM --> SDP --> VIDEO_TRACK
    MIC --> SDP --> AUDIO_TRACK

    VIDEO_TRACK --> DF --> EMOTION_OUT
    VIDEO_TRACK --> GT --> EMOTION_OUT
    VIDEO_TRACK --> REC --> FILE_OUT

    AUDIO_TRACK --> STT_P --> TEXT_OUT
    AUDIO_TRACK --> REC
