graph TB
    subgraph CLIENT["Presentation Layer - Next.js"]
        direction LR
        LANDING["/ Landing"]
        DASHBOARD["/dashboard"]
        INTERVIEW["/interview"]
        CODING["/coding"]
        WHITEBOARD["/whiteboard"]
        EMOTION["/emotion"]
        PROFILE["/profile"]
        SETTINGS["/settings"]
    end

    subgraph GATEWAY["Gateway / API Layer - FastAPI"]
        direction LR
        API_SERVER["integrated_interview_server.py\n80+ REST Endpoints"]
        WS_SERVER["WebSocket Server\n/ws/interview"]
        WEBRTC["WebRTC Signaling\n/offer aiortc"]
        PROXY["Next.js Proxy"]
    end

    subgraph AI["AI / ML Processing Layer"]
        direction TB
        subgraph LLM_ENGINE["LLM Engine"]
            WORKFLOW["interview_workflow.py\nLangGraph StateMachine"]
            TEXT_IV["text_interview.py"]
        end
        subgraph RAG_SYS["RAG System"]
            RESUME_RAG["resume_rag.py\nPGVector + OllamaEmbeddings"]
        end
        subgraph STT_SYS["STT Engine"]
            STT["stt_engine.py\nDeepgram Realtime"]
            WHISPER["whisper_stt_service.py\nWhisper Fallback"]
        end
        subgraph TTS_SYS["TTS Engine"]
            TTS["hume_tts_service.py\nHume AI EVI"]
        end
        subgraph EMOTION_SYS["Emotion Analysis - Multimodal"]
            PROSODY["hume_prosody_service.py\nVoice Emotion 48"]
            DEEPFACE["DeepFace\nFacial Emotion 7"]
        end
        subgraph OTHER_AI["Other AI Services"]
            CODE_EXEC["code_execution_service.py\nDocker Sandbox"]
            WB_SVC["whiteboard_service.py\nVision AI"]
            DID["did_avatar_service.py\nD-ID Avatar"]
            SPEECH["speech_analysis_service.py\nSpeech Rate"]
            GAZE["gaze_tracking_service.py\nEye Tracking"]
        end
    end

    subgraph REALTIME["Real-time Processing Layer"]
        direction LR
        EVENT_BUS["event_bus.py\nEvent Dispatcher"]
        EVENTS["events.py\n30+ EventTypes"]
        HANDLERS["event_handlers.py"]
        MEDIA_REC["media_recording_service.py\nGStreamer Recording"]
    end

    subgraph ASYNC["Background Processing - Celery"]
        direction LR
        CELERY_APP["celery_app.py\n8 Dedicated Queues"]
        CELERY_TASKS["celery_tasks.py\nAsync Tasks"]
    end

    subgraph DATA["Data Layer"]
        direction LR
        POSTGRES[("PostgreSQL\n+ pgvector")]
        REDIS[("Redis\nCache / Broker")]
        FILE_STORE[("File Storage\nuploads/")]
    end

    subgraph SECURITY["Security Layer"]
        SEC["security.py\nJWT + bcrypt"]
        LATENCY["latency_monitor.py\nSLA Monitoring"]
        JSON_UTIL["json_utils.py\nLLM JSON Parsing"]
    end

    CLIENT -->|"REST API"| API_SERVER
    CLIENT -->|"WebSocket"| WS_SERVER
    CLIENT -->|"WebRTC"| WEBRTC
    API_SERVER -->|"Proxy"| PROXY

    API_SERVER --> WORKFLOW
    API_SERVER --> TEXT_IV
    API_SERVER --> RESUME_RAG
    API_SERVER --> STT
    API_SERVER --> WHISPER
    API_SERVER --> TTS
    API_SERVER --> PROSODY
    API_SERVER --> DEEPFACE
    API_SERVER --> CODE_EXEC
    API_SERVER --> WB_SVC
    API_SERVER --> DID
    API_SERVER --> SPEECH
    API_SERVER --> GAZE

    WORKFLOW --> RESUME_RAG
    WEBRTC --> STT
    WEBRTC --> DEEPFACE
    WEBRTC --> GAZE
    WEBRTC --> MEDIA_REC

    API_SERVER --> EVENT_BUS
    EVENT_BUS --> EVENTS
    EVENT_BUS --> HANDLERS
    EVENT_BUS -->|"WebSocket Push"| WS_SERVER
    EVENT_BUS -->|"Redis Pub/Sub"| REDIS

    API_SERVER -->|"Submit Task"| CELERY_TASKS
    CELERY_TASKS --> CELERY_APP
    CELERY_APP --> REDIS

    API_SERVER --> POSTGRES
    RESUME_RAG --> POSTGRES
    API_SERVER --> REDIS
    API_SERVER --> FILE_STORE
    MEDIA_REC --> FILE_STORE

    API_SERVER --> SEC
    API_SERVER --> LATENCY
    API_SERVER --> JSON_UTIL
