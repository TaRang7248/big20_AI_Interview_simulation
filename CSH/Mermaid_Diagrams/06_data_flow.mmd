flowchart TD
    START(["Interview Start"]) --> UPLOAD["Resume PDF Upload"]
    UPLOAD --> RAG["RAG Processing\nPDF to Chunking to Embedding\nto PGVector"]
    RAG --> SESSION["Session Create\n/api/session/create"]
    SESSION --> WEBRTC_CONN["WebRTC Connect\nCamera + Microphone"]

    WEBRTC_CONN --> PARALLEL

    subgraph PARALLEL["Realtime Parallel Processing"]
        direction TB
        LOOP_START["Question Loop Start"]

        LOOP_START --> GEN_Q["Question Generation\nRAG Context + LLM"]
        GEN_Q --> TTS_Q["TTS Conversion\nHume AI"]
        TTS_Q --> PLAY["Voice Play + Avatar"]
        PLAY --> WAIT["Wait for Answer"]

        WAIT --> STT_ANS["STT Transcription\nDeepgram"]
        STT_ANS --> EVAL["Answer Evaluation\nLLM"]

        WAIT --> FACE["Facial Analysis\nDeepFace"]
        WAIT --> VOICE_E["Voice Emotion\nHume Prosody"]
        WAIT --> GAZE_T["Eye Tracking"]
        WAIT --> SPEECH_A["Speech Rate Analysis"]

        EVAL --> ROUTE{"Routing"}
        ROUTE -->|"Follow-up"| GEN_Q
        ROUTE -->|"Next Topic"| GEN_Q
        ROUTE -->|"Complete"| DONE
    end

    DONE["Interview End"] --> REPORT

    subgraph REPORT["Report Generation"]
        STAR["STAR Analysis\nLLM"]
        EMOTION_AGG["Emotion Data Aggregation"]
        SCORE["Total Score Calculation"]
        PDF["PDF Report\nReportLab"]
    end

    REPORT --> DASHBOARD_VIEW["View on Dashboard"]
