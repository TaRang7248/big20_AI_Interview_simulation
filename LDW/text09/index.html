<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 면접 프로그램</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <style>
        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #loading-overlay.hidden {
            display: none;
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 1.2rem;
            color: #333;
            font-weight: 500;
        }
    </style>
</head>

<body>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <div class="loading-text" id="loading-text">잠시만 기다려주세요...</div>
    </div>

    <!-- Notification / Toast Container -->
    <div id="toast-container"></div>

    <!-- Main App Container -->
    <div id="app">

        <!-- Navigation (Conditional Rendering in JS) -->
        <nav id="navbar" class="hidden">
            <div class="logo">AI Interview</div>
            <div class="nav-links">
                <span id="user-display"></span>
                <button id="btn-logout" class="btn-text">로그아웃</button>
            </div>
        </nav>

        <!-- 1.1 Login Screen -->
        <section id="login-page" class="page active">
            <div class="auth-container">
                <h1>AI 면접 프로그램</h1>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-id">아이디</label>
                        <input type="text" id="login-id" placeholder="ID를 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label for="login-pw">비밀번호</label>
                        <input type="password" id="login-pw" placeholder="비밀번호를 입력하세요" required>
                    </div>
                    <button type="submit" class="btn-primary">로그인</button>
                </form>
                <div class="auth-links">
                    <a href="#" id="link-signup">회원가입</a> | <a href="#">ID/PW 찾기</a>
                </div>
            </div>
        </section>

        <!-- 1.2 Sign Up Screen -->
        <section id="signup-page" class="page hidden">
            <div class="auth-container">
                <h2>회원가입</h2>
                <form id="signup-form">
                    <div class="form-group">
                        <label for="reg-id">아이디</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="text" id="reg-id" required style="flex: 1;">
                            <button type="button" id="btn-check-id" class="btn-secondary"
                                style="white-space: nowrap;">중복확인</button>
                        </div>
                        <div id="id-check-msg" style="font-size: 0.9em; margin-top: 5px; min-height: 20px;"></div>

                    </div>
                    <div class="form-group">
                        <label for="reg-pw">비밀번호</label>
                        <input type="password" id="reg-pw" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-name">이름</label>
                        <input type="text" id="reg-name" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-dob-year">생년월일</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="reg-dob-year" placeholder="YYYY" maxlength="4" required
                                style="flex: 1;">
                            <input type="text" id="reg-dob-month" placeholder="MM" maxlength="2" required
                                style="flex: 1;">
                            <input type="text" id="reg-dob-day" placeholder="DD" maxlength="2" required
                                style="flex: 1;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-gender">성별</label>
                        <select id="reg-gender" required>
                            <option value="">선택하세요</option>
                            <option value="male">남성</option>
                            <option value="female">여성</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reg-email">이메일</label>
                        <input type="email" id="reg-email" placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-addr">주소</label>
                        <input type="text" id="reg-addr" placeholder="주소를 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-phone-1">전화번호</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="tel" id="reg-phone-1" placeholder="010" maxlength="3" required
                                style="flex: 1;">
                            <input type="tel" id="reg-phone-2" placeholder="0000" maxlength="4" required
                                style="flex: 1;">
                            <input type="tel" id="reg-phone-3" placeholder="0000" maxlength="4" required
                                style="flex: 1;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>회원 유형</label>
                        <div class="radio-group">
                            <label><input type="radio" name="reg-type" value="applicant" checked> 면접자</label>
                            <label><input type="radio" name="reg-type" value="admin"> 관리자</label>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">가입하기</button>
                    <button type="button" class="btn-secondary" id="btn-back-login">취소</button>
                </form>
            </div>
        </section>

        <!-- 1.3.1 Password Check Screen -->
        <section id="password-check-page" class="page hidden">
            <div class="container">
                <h2>정보 수정 본인 확인</h2>
                <div class="profile-card">
                    <form id="password-check-form">
                        <div class="form-group">
                            <label>비밀번호를 입력해주세요</label>
                            <input type="password" id="check-pw-input" required>
                        </div>
                        <button type="submit" class="btn-primary">확인</button>
                        <button type="button" class="btn-secondary" id="btn-cancel-pw-check">취소</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- 1.3.2 My Info Screen -->
        <section id="myinfo-page" class="page hidden">
            <div class="container">
                <h2>회원 정보 수정</h2>
                <div class="profile-card">
                    <form id="myinfo-form">
                        <!-- Read-only fields -->
                        <div class="form-group">
                            <label>아이디</label>
                            <input type="text" id="edit-id" readonly disabled class="readonly-input">
                        </div>
                        <div class="form-group">
                            <label>이름</label>
                            <input type="text" id="edit-name" readonly disabled class="readonly-input">
                        </div>
                        <div class="form-group">
                            <label>생년월일</label>
                            <input type="text" id="edit-dob" readonly disabled class="readonly-input">
                        </div>
                        <div class="form-group">
                            <label>성별</label>
                            <input type="text" id="edit-gender" readonly disabled class="readonly-input">
                        </div>

                        <!-- Editable fields -->
                        <div class="form-group">
                            <label>이메일</label>
                            <input type="email" id="edit-email">
                        </div>
                        <div class="form-group">
                            <label>주소</label>
                            <input type="text" id="edit-addr">
                        </div>
                        <div class="form-group">
                            <label>전화번호</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="tel" id="edit-phone-1" placeholder="010" maxlength="3" style="flex: 1;">
                                <input type="tel" id="edit-phone-2" placeholder="0000" maxlength="4" style="flex: 1;">
                                <input type="tel" id="edit-phone-3" placeholder="0000" maxlength="4" style="flex: 1;">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">정보 수정 완료</button>
                        <button type="button" class="btn-primary" id="btn-change-pw">비밀번호 변경</button>
                        <button type="button" class="btn-secondary" id="btn-cancel-myinfo">취소</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- 1.3.3 Password Change Page -->
        <section id="password-change-page" class="page hidden">
            <div class="container">
                <h2>비밀번호 변경</h2>
                <div class="profile-card">
                    <form id="password-change-form">
                        <div class="form-group">
                            <label>새로운 비밀번호</label>
                            <input type="password" id="new-pw" required>
                        </div>
                        <div class="form-group">
                            <label>새로운 비밀번호 확인</label>
                            <input type="password" id="confirm-new-pw" required>
                        </div>
                        <button type="submit" class="btn-primary">비밀번호 변경 완료</button>
                        <button type="button" class="btn-secondary" id="btn-cancel-pw-change">취소</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- 2.1 Applicant Dashboard -->
        <section id="applicant-dashboard-page" class="page hidden">
            <div class="container dashboard-layout">
                <aside class="sidebar">
                    <h3>지원자 메뉴</h3>
                    <ul>
                        <li><a href="#" class="active" onclick="return false;">지원 공고 목록</a></li>
                        <li><a href="#" id="link-my-records">내 면접 기록</a></li>
                        <li><a href="#" id="link-my-info">내 정보</a></li>
                    </ul>
                </aside>
                <main class="content">
                    <h2>지원 가능한 공고</h2>
                    <ul id="job-list" class="card-list">
                        <!-- Job Items rendered by JS -->
                    </ul>
                </main>
            </div>
        </section>

        <!-- 2.1.0 My Interview Records -->
        <section id="my-records-page" class="page hidden">
            <div class="container dashboard-layout">
                <aside class="sidebar">
                    <h3>지원자 메뉴</h3>
                    <ul>
                        <li><a href="#" onclick="navigateTo('applicant-dashboard-page'); return false;">지원 공고 목록</a>
                        </li>
                        <li><a href="#" class="active" onclick="return false;">내 면접 기록</a></li>
                        <li><a href="#" id="link-my-info-side">내 정보</a></li>
                    </ul>
                </aside>
                <main class="content">
                    <h2>내 면접 기록</h2>
                    <div class="profile-card" style="padding: 0; overflow: hidden;">
                        <table class="table" id="my-records-table">
                            <thead>
                                <tr>
                                    <th>공고 제목</th>
                                    <th>공고 직업</th>
                                    <th>면접한 시간</th>
                                    <th>합격&불합격 결과</th>
                                </tr>
                            </thead>
                            <tbody id="my-records-list">
                                <!-- Records will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                </main>
            </div>
        </section>

        <!-- 2.1.1 Job Detail Page -->
        <section id="job-detail-page" class="page hidden">
            <div class="container">
                <h2>공고 상세 정보</h2>
                <div class="profile-card">
                    <h3 id="detail-job-title"
                        style="margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px;"></h3>

                    <div class="form-group">
                        <label>직무</label>
                        <div id="detail-job-job" style="font-weight: 500;"></div>
                    </div>

                    <div class="form-group">
                        <label>작성자</label>
                        <div id="detail-job-writer" style="font-weight: 500;"></div>
                    </div>

                    <div class="form-group">
                        <label>생성일</label>
                        <div id="detail-job-created-at" style="color: #555;"></div>
                    </div>

                    <div class="form-group">
                        <label>마감일</label>
                        <div id="detail-job-deadline" style="color: #e74c3c; font-weight: bold;"></div>
                    </div>

                    <div class="form-group">
                        <label>공고 내용</label>
                        <div id="detail-job-content"
                            style="white-space: pre-wrap; background: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 100px;">
                        </div>
                    </div>

                    <div class="actions" style="margin-top: 30px;">
                        <button id="btn-apply-job" class="btn-primary">지원하기 (면접 시작)</button>
                        <button id="btn-back-to-list" class="btn-secondary">목록으로</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2.1 Interview Setup (Modified for Automatic Test) -->
        <section id="interview-setup-page" class="page hidden">
            <div class="container setup-container">
                <h2 id="setup-job-title">공고 제목</h2>
                <div class="setup-steps">
                    <div class="step-card">
                        <h3>1. 이력서 업로드</h3>
                        <p>면접에 사용할 이력서를 등록해주세요. (PDF 파일만 가능)</p>
                        <input type="file" id="resume-upload" accept=".pdf">
                        <div id="resume-status" style="font-size: 0.9em; margin-top: 5px; color: #666;"></div>
                    </div>
                    <div class="step-card">
                        <h3>2. 환경 테스트</h3>
                        <!-- Device check happens automatically -->
                        <div class="device-check">
                            <div class="check-item"><span class="icon">📷</span> 카메라: <span id="cam-status"
                                    class="status pending">확인 중...</span></div>
                            <div class="check-item"><span class="icon">🎙️</span> 마이크: <span id="mic-status"
                                    class="status pending">확인 중...</span></div>
                        </div>
                        <p style="font-size: 0.9em; color: gray;">카메라와 마이크가 자동으로 연결됩니다.</p>
                        <!-- Removed manual button -->
                    </div>
                </div>
                <div class="actions">
                    <button id="btn-start-interview" class="btn-primary" disabled>면접 시작</button>
                    <button id="btn-cancel-interview" class="btn-secondary">뒤로가기</button>
                </div>
            </div>
        </section>

        <!-- 2.2 Interview In-Progress -->
        <section id="interview-page" class="page hidden">
            <div class="interview-room">
                <div class="interview-header">
                    <div class="timer">남은 시간: <span id="timer-display">00:00</span></div>
                    <div class="progress-bar-container">
                        <div class="progress-label" id="phase-label">AI 면접 진행 중</div>
                        <ul id="progress-gauge" class="progress-gauge"></ul>
                        <span id="progress-text" class="progress-text">1/12</span>
                    </div>
                </div>

                <div class="interview-main">
                    <!-- AI Interviewer Area -->
                    <div class="interviewer-area">
                        <div class="avatar-wrapper">
                            <div class="ai-avatar">🤖</div> <!-- Placeholder for AI Face -->
                        </div>
                        <div class="chat-bubble ai" id="ai-message">면접관 연결 중...</div>
                    </div>

                    <!-- User Area -->
                    <div class="user-area">
                        <video id="user-video" autoplay playsinline muted></video>
                        <span class="feed-label" id="feed-label">내 모습 (Recording...)</span>
                    </div>
                </div>

                <!-- Interaction Area -->
                <div class="interview-controls">
                    <div class="chat-log" id="chat-log">
                        <!-- History of Q&A -->
                    </div>
                    <div class="input-area">
                        <!-- Removed Code Board for now as request focused on Q&A -->
                        <!-- Text area for fallback or status, mostly handled by audio -->
                        <textarea id="user-answer" placeholder="답변을 말씀하시면 음성이 녹음됩니다..." rows="3" disabled></textarea>
                        <button id="btn-submit-answer" class="btn-primary">답변 제출 (녹음 종료)</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2.3 Interview Result -->
        <section id="result-page" class="page hidden">
            <div class="container result-container">
                <h2>면접 종료</h2>
                <div class="result-card">
                    <p class="result-message" id="result-desc">
                        면접이 종료되었습니다.<br>
                        AI 면접관이 답변을 평가하고 있습니다.<br><br>
                        수고하셨습니다.
                    </p>
                </div>
                <button id="btn-go-home" class="btn-primary">홈으로</button>
            </div>
        </section>

        <!-- 3. Admin Dashboard -->
        <section id="admin-dashboard-page" class="page hidden">
            <div class="container dashboard-layout">
                <aside class="sidebar">
                    <h3>관리자 메뉴</h3>
                    <ul>
                        <li><a href="#" class="active" id="admin-menu-jobs">공고 관리</a></li>
                        <li><a href="#" id="admin-menu-applicants">지원자 현황</a></li>
                        <li><a href="#" id="admin-link-my-info">내 정보</a></li>
                    </ul>
                </aside>
                <main class="content">
                    <!-- Admin Views (Jobs, Applicants) -->
                    <div id="admin-view-jobs">
                        <div class="content-header">
                            <h2>면접 공고 관리</h2>
                            <button id="btn-add-job" class="btn-small">공고 등록</button>
                        </div>
                        <table class="table" id="admin-job-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>직무</th>
                                    <th>제목</th>
                                    <th>작성자</th>
                                    <th>생성일</th>
                                    <th>마감일</th>
                                    <th>관리</th>
                                </tr>
                            </thead>
                            <tbody><!-- JS Render --></tbody>
                        </table>
                    </div>

                    <!-- Job Register -->
                    <div id="admin-job-register-page" class="hidden">
                        <h2>공고 등록</h2>
                        <div class="profile-card">
                            <form id="admin-job-form">
                                <div class="form-group">
                                    <label>공고 제목</label>
                                    <input type="text" id="job-title" required>
                                </div>
                                <div class="form-group">
                                    <label>직무 (Job)</label>
                                    <input type="text" id="job-job" placeholder="예: 백엔드 개발자" required>
                                </div>
                                <div class="form-group">
                                    <label>공고 내용</label>
                                    <textarea id="job-content" rows="5" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label>마감일</label>
                                    <input type="date" id="job-deadline" required>
                                </div>
                                <button type="submit" class="btn-primary">공고 등록 완료</button>
                                <button type="button" class="btn-secondary" id="btn-cancel-job-register">취소</button>
                            </form>
                        </div>
                    </div>

                    <!-- Job Edit -->
                    <div id="admin-job-edit-page" class="hidden">
                        <h2>공고 수정</h2>
                        <div class="profile-card">
                            <form id="admin-job-edit-form">
                                <input type="hidden" id="edit-job-id">
                                <div class="form-group">
                                    <label>공고 제목</label>
                                    <input type="text" id="edit-job-title" required>
                                </div>
                                <div class="form-group">
                                    <label>직무 (Job)</label>
                                    <input type="text" id="edit-job-job" required>
                                </div>
                                <div class="form-group">
                                    <label>공고 내용</label>
                                    <textarea id="edit-job-content" rows="5" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label>마감일</label>
                                    <input type="date" id="edit-job-deadline" required>
                                </div>
                                <button type="submit" class="btn-primary">공고 수정 완료</button>
                                <button type="button" class="btn-secondary" id="btn-cancel-job-edit">취소</button>
                            </form>
                        </div>
                    </div>

                    <div id="admin-view-applicants" class="hidden">
                        <h2>지원자 현황</h2>
                        <table class="table" id="admin-app-table">
                            <thead>
                                <tr>
                                    <th>이름</th>
                                    <th>지원 공고</th>
                                    <th>직무</th>
                                    <th>면접 일시</th>
                                    <th>질문/답변 확인</th>
                                </tr>
                            </thead>
                            <tbody><!-- JS Render --></tbody>
                        </table>
                    </div>
                </main>
            </div>
        </section>

    </div>

    <!-- Applicant Detail Modal -->
    <div id="applicant-detail-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detail-modal-title">지원자 상세 정보</h2>
                <button class="btn-close" id="btn-close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid">
                    <!-- Final Result Summary -->
                    <div class="result-summary">
                        <div class="detail-section-title">최종 평가 결과</div>
                        <div id="detail-pass-status" class="pass-status"></div>
                        <div class="score-grid">
                            <!-- Tech -->
                            <div class="score-card">
                                <div class="score-header">
                                    <span class="score-label">기술/직무</span>
                                    <span id="score-val-tech" class="score-number">0</span>
                                </div>
                                <div id="eval-text-tech" class="score-text">평가 내용이 없습니다.</div>
                            </div>
                            <!-- Problem Solving -->
                            <div class="score-card">
                                <div class="score-header">
                                    <span class="score-label">문제해결</span>
                                    <span id="score-val-problem" class="score-number">0</span>
                                </div>
                                <div id="eval-text-problem" class="score-text">평가 내용이 없습니다.</div>
                            </div>
                            <!-- Communication -->
                            <div class="score-card">
                                <div class="score-header">
                                    <span class="score-label">의사소통</span>
                                    <span id="score-val-comm" class="score-number">0</span>
                                </div>
                                <div id="eval-text-comm" class="score-text">평가 내용이 없습니다.</div>
                            </div>
                            <!-- Attitude -->
                            <div class="score-card">
                                <div class="score-header">
                                    <span class="score-label">태도/인성</span>
                                    <span id="score-val-attitude" class="score-number">0</span>
                                </div>
                                <div id="eval-text-attitude" class="score-text">평가 내용이 없습니다.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Resume Section -->
                    <div class="detail-column">
                        <div class="detail-section-title">이력서 내용</div>
                        <div id="detail-resume" class="resume-box"></div>
                    </div>

                    <!-- Interview Log Section -->
                    <div class="detail-column">
                        <div class="detail-section-title">면접 대화 기록</div>
                        <div id="detail-log" class="log-box"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Image Zoom Modal -->
    <div id="image-zoom-modal" class="modal hidden" style="z-index: 3000;">
        <span class="close-zoom">&times;</span>
        <img class="modal-content-img" id="zoomed-image">
    </div>

    <!-- Logic -->
    <script src="app.js"></script>
</body>

</html>