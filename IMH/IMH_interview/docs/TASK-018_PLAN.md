# TASK-018: 실전/연습 모드 정책 분리 설계 (Interview Mode Policy Split)

## 1. 개요 및 목적 (Purpose)

### 1.1 정책 분리 배경
TASK-017에서 구현된 `InterviewSessionEngine`은 상태 전이와 기본 흐름을 제어하는 **실행 엔진(Execution Engine)**이다. 그러나 실제 서비스는 "공고 기반 실전 면접"과 "AI 면접 연습 모드"라는 두 가지 상이한 **비즈니스 정책(Business Policy)**을 요구한다.

엔진 자체에 비즈니스 로직을 하드코딩하면 유지보수성이 떨어지고 새로운 모드 추가가 어려워진다. 따라서 **엔진(실행)과 정책(규칙)을 분리**하여, 동일한 엔진 위에서 서로 다른 모드가 동작하도록 설계해야 한다.

### 1.2 목적
1.  **책임 분리**: 세션 엔진은 "어떻게(How) 실행할지"만 담당하고, 정책 레이어는 "무엇을(What) 허용할지"를 결정한다.
2.  **모드별 경험 차별화**: 실전 모드의 엄격함(일시정지 불가, 중단 시 종료)과 연습 모드의 유연함(재시도, 피드백)을 명확히 구분한다.
3.  **확장성 확보**: 향후 "모의고사 모드", "기관용 모드" 등 새로운 정책이 추가될 때 엔진 수정 없이 설정(Configuration)만으로 대응할 수 있는 기반을 마련한다.

---

## 2. 실전 vs 연습 모드 정책 차이 (Policy Differences)

| 항목 | 실전 모드 (Actual / Job Posting) | 연습 모드 (Practice / Free) |
| :--- | :--- | :--- |
| **기본 성격** | 채용 평가용, 엄격한 규칙 적용 | 자가 진단 및 학습용, 유연한 규칙 적용 |
| **모델 선택** | **관리자 지정** (공고 등록 시 고정, 변경 불가) | **사용자 선택** (입장 시 자유 선택) |
| **카메라/마이크** | 필수 (엄격한 감지) | 필수 (학습 목적) |
| **질문 표시** | 관리자 설정에 따름 (TTS Only / Text 병행) | 항상 **Text + TTS** 제공 (학습 보조) |
| **일시정지** | **불가** (Non-pausable) | **허용** (이전 상태 복구 가능) |
| **재시도** | **불가** (답변 완료 후 수정 불가) | **허용** (마음에 들지 않으면 다시 답변 가능) |
| **재질문 요청** | 기본 **비활성** (관리자 옵션) | **허용** (질문 다시 듣기 가능) |
| **관리자 개입** | 공고 설정이 절대적 우선순위 | 시스템 기본값 적용 (사용자 편의 우선) |

---

## 3. 최소 질문 수 및 조기 종료 정책 (Minimum Question Policy)

### 3.1 실전 모드 (Actual)
*   **최소 질문 수 보장 (강제)**: 관리자가 설정한 최소 질문 수(기본 10문항 권장)는 어떠한 경우에도 반드시 수행되어야 한다.
*   **무응답 처리**: 답변 없이 침묵하여 질문이 넘어가는 경우(No-Answer)라도, 해당 질문은 **"수행된 질문"**으로 카운트한다. 즉, 무응답이 반복되어도 최소 질문 수는 채워진다.
*   **조기 종료 제한**: 점수 미달 등에 의한 **조기 종료(Early Exit)**는 반드시 **최소 질문 수를 충족한 이후**에만 발동할 수 있다. 그 이전에는 점수가 낮더라도 세션을 강제로 종료하지 않는다.

### 3.2 연습 모드 (Practice)
*   **최소 질문 수 적용**: 기본적으로 적용하지 않거나, 사용자가 언제든 중단/종료할 수 있는 유연한 정책을 따른다. 조기 종료 조건보다는 사용자 의사에 따른 종료를 우선한다.

---

## 4. 중단 및 복구 정책 (Interruption & Recovery)

### 4.1 실전 모드 (Actual)
*   **중단 처리**: 네트워크 끊김, 브라우저 종료, 사용자 강제 종료 등 원인 불문하고 세션이 중단되면 **`INTERRUPTED` 상태로 종료** 처리한다.
*   **복구 불가**: 원칙적으로 중단된 세션의 재진입(Resume)을 허용하지 않는다. 별도의 예외 처리 프로세스(관리자)에 따른다.
*   **상태 전이**: `IN_PROGRESS` -> `INTERRUPTED` (Final State).
*   **결과 처리**: 중단 시점까지 확보된 데이터만 저장하며, "면접 포기/중단"으로 기록된다.

### 4.2 연습 모드 (Practice)
*   **중단 처리**: 세션이 비정상 종료되더라도 상태를 유지하거나, 재접속 시 **이어하기(Resume)** 옵션을 제공한다.
*   **재시작 허용**: 사용자가 원할 경우 중단된 지점부터 다시 시작하거나, 아예 처음부터 다시 시작(Reset)할 수 있다.
*   **상태 전이**: `INTERRUPTED` 상태에서 다시 `IN_PROGRESS`로의 전이를 허용한다.

---

## 5. 세션 상태 전이 차이 (State Transitions)

`InterviewSessionEngine`의 상태 머신(`SessionStatus`)은 공통으로 사용되나, 허용되는 전이 경로(Transition Path)가 다르다.

| 상태 전이 | 실전 모드 허용 여부 | 연습 모드 허용 여부 | 비고 |
| :--- | :---: | :---: | :--- |
| `APPLIED` → `IN_PROGRESS` | O | O | 시작 |
| `IN_PROGRESS` → `COMPLETED` | O | O | 정상 종료 |
| `IN_PROGRESS` → `INTERRUPTED` | O | O | 중단 발생 |
| `INTERRUPTED` → `IN_PROGRESS` | **X (금지)** | **O (허용)** | 재진입/이어하기 |
| `COMPLETED` → `EVALUATED` | O | O | 평가 진행 |
| `INTERRUPTED` → `EVALUATED` | O (부분 평가) | X (평가 불필요) | 실전은 중단돼도 데이터 평가 필요 |

---

## 6. 무응답/침묵 처리 책임 경계 (Responsibility Boundary)

무응답(No-Answer) 상황에 대한 처리는 **정책(Policy)**과 **평가(Evaluation)**의 책임이 분리되어야 한다.

### 6.1 Policy Layer 의 책임
*   **허용/진행 판단**: 침묵 시간이 초과되었을 때, 이를 "질문 완료"로 간주하고 **다음 질문으로 넘어갈지 여부**를 결정한다.
*   **상태 전이 제어**: 무응답이 발생했을 때 세션을 종료할지, 계속 진행할지(최소 질문 수 정책에 따라)를 판단한다.
*   **점수 관여 안 함**: 정책 레이어는 점수를 계산하거나 페널티를 부여하지 않는다. 오직 "진행 흐름"만 제어한다.

### 6.2 Evaluation Engine 의 책임
*   **점수 반영**: 전달받은 무응답 플래그(`is_no_answer=True`)를 기반으로, 해당 질문에 대한 **점수(0점 처리 등)를 산출**한다.
*   **페널티 계산**: 연속된 무응답이나 특정 유형의 침묵에 대한 **가중치 페널티**를 계산한다.
*   **근거 저장**: 무응답이 발생했다는 사실을 평가 근거(Evidence)로 기록한다.

---

## 7. 결과 노출 정책 (Result Exposure)

### 7.1 면접 진행 중 (In-Session)
*   **실전 모드**: 점수, 합/불합 예측 등 평가 관련 정보 **절대 비공개**. 오직 진행률(Progress)만 표시하여 긴장감을 유지하고 부정행위를 방지한다.
*   **연습 모드**: 실시간 피드백(발화 속도, 시선 처리 등)을 제공할 수 있다. (기본적으로는 종료 후 제공이나, 옵션에 따라 실시간 힌트 허용)

### 7.2 면접 종료 후 (Post-Session)
*   **실전 모드**: **관리자 설정(공고 옵션)**에 따른다.
    *   **공개 시점**: 즉시 / 지정 일시 / 관리자 승인 후
    *   **공개 범위**: 합불만 / 요약 / 상세 / 비공개
    *   **강제 정책**: 설정과 무관하게 **면접 후 14일(2주) 이내 합/불합 자동 통지**는 시스템이 보장한다.
*   **연습 모드**: 종료 즉시 **상세 분석 리포트(Full Report)**를 제공하여 학습 효과를 극대화한다.

---

## 8. 권한 및 관리자 설정 연계 (Permission & Configuration)

### 8.1 정책 스냅샷 (Policy Snapshot)
*   **시점 고정**: 실전 모드 세션이 생성되는 시점(`APPLIED`)에 해당 공고의 정책 설정(옵션, 제한시간, 모델 등)을 복사하여 세션 내부에 저장한다.
*   **불변성**: 세션 진행 도중 관리자가 공고 설정을 변경하더라도, **이미 생성된 세션에는 영향을 주지 않는다.**

### 8.2 관리자 설정 범위
관리자는 공고 등록 시 다음 정책을 설정하며, 이는 엔진에 주입되는 `SessionConfig`를 결정한다.
*   질문당 제한시간 / 침묵 자동완료 시간
*   최소/최대 질문 수 및 필수 질문 목록
*   평가 가중치 (Evaluation Weights)
*   결과 공개 시점 및 범위

---

## 9. 정책 레이어링 구조 정의 (Layering Strategy)

구현 단계에서 적용할 설계의 방향성을 정의한다.

1.  **정책 계층의 존재 (Policy Layer Concept)**
    *   엔진의 실행 로직과 분리된 별도의 **정책 결정 계층**이 존재해야 한다.
    *   이 계층은 엔진이 특정 행동(일시정지, 재시도, 결과 공개 등)을 수행하려 할 때, 현재 모드와 상태에 따라 "허용/거부"를 판단하는 역할을 한다.

2.  **책임 경계 (Boundaries)**
    *   **Engine**: 상태를 관리하고 질문을 진행시킨다. 정책 계층에 "이 행동을 해도 되는가?"를 문의한다.
    *   **Policy**: 정해진 규칙(실전 vs 연습)에 따라 엔진의 질문에 답한다. 상태를 직접 변경하지 않는다.

3.  **정책 주입 (Injection)**
    *   세션 생성 시점에 해당 세션의 모드(실전/연습)에 맞는 적절한 정책 구현체가 엔진에 주입(Injection)되어야 한다.
    *   이를 통해 엔진 코드를 수정하지 않고도 새로운 모드나 정책을 추가할 수 있는 유연성을 확보한다.

---

## 10. 작업 범위 및 제약 사항 (Scope & Constraints)

### 10.1 본 TASK 포함 (In-Scope)
*   위 설계 내용을 바탕으로 한 정책 분리 상세 계획 수립.
*   `IMH/IMH_Interview/docs/TASK-018_PLAN.md` 문서 작성 및 확정.

### 10.2 본 TASK 제외 (Out-of-Scope)
*   **코드 구현**: 실제 엔진 코드 수정, DTO 변경 등은 하지 않는다.
*   **UI 구현**: 화면 설계나 프론트엔드 작업은 포함하지 않는다.
*   **DB 스키마 변경**: 정책 저장을 위한 테이블 설계는 다루지 않는다.

### 10.3 규정 준수
*   기존 TASK-017에서 검증된 State Machine의 무결성을 해치지 않아야 한다.
*   LOGGING 정책을 준수하여 정책 위반 시도 등에 대한 로그를 남겨야 한다 (추후 구현 시).
